

<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ” - Nanciico&#39;s Blog</title><meta name="Description" content="åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚"><meta property="og:title" content="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”" />
<meta property="og:description" content="åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-19T00:00:00+00:00" /><meta property="og:site_name" content="Nanciico&#39;s Blog" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”"/>
<meta name="twitter:description" content="åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚"/>
<meta name="application-name" content="DoIt">
<meta name="apple-mobile-web-app-title" content="DoIt">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" /><link rel="prev" href="https://Nanciico.github.io/%E7%AE%97%E6%B3%95%E7%AC%AC%E5%9B%9B%E7%89%88_05_union-find%E7%AE%97%E6%B3%95/" /><link rel="next" href="https://Nanciico.github.io/%E7%AE%97%E6%B3%95%E7%AC%AC%E5%9B%9B%E7%89%88_06_%E5%88%9D%E7%BA%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/Nanciico.github.io\/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87\/"
        },"genre": "posts","keywords": "Redis","wordcount":  2468 ,
        "url": "https:\/\/Nanciico.github.io\/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87\/","datePublished": "2023-04-19T00:00:00+00:00","dateModified": "2023-04-19T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Nanciico"
            },"description": "åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚"
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="auto" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Nanciico&#39;s Blog"><span class="header-title-pre">ğŸ¥³</span><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/tags/" title="æ ‡ç­¾"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/" title="åˆ†ç±»"> åˆ†ç±» </a><a class="menu-item" href="/series" title="ç³»åˆ—"> ç³»åˆ— </a><a class="menu-item" href="https://github.com/Nanciico" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Nanciico&#39;s Blog"><span class="header-title-pre">ğŸ¥³</span><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/tags/" title="æ ‡ç­¾">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="åˆ†ç±»">åˆ†ç±»</a><a class="menu-item" href="/series" title="ç³»åˆ—">ç³»åˆ—</a><a class="menu-item" href="https://github.com/Nanciico" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">ç›®å½•</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› ">å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› </a>
      <ul>
        <li><a href="#å†…å­˜åˆ†é…åŸå› ">å†…å­˜åˆ†é…åŸå› </a></li>
        <li><a href="#é¢‘ç¹ä¿®æ”¹-redis-ä¸­æ•°æ®">é¢‘ç¹ä¿®æ”¹ Redis ä¸­æ•°æ®</a></li>
      </ul>
    </li>
    <li><a href="#å†…å­˜ç¢ç‰‡ç‡">å†…å­˜ç¢ç‰‡ç‡</a></li>
    <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®">å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®</a></li>
    <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°">å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°</a>
      <ul>
        <li><a href="#æ§åˆ¶å ç”¨-cpu-æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°">æ§åˆ¶å ç”¨ CPU æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°</a></li>
        <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°">å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°</a></li>
        <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†å¤§-key-æ˜¯å¦é˜»å¡">å†…å­˜ç¢ç‰‡æ•´ç†å¤§ Key æ˜¯å¦é˜»å¡</a></li>
      </ul>
    </li>
    <li><a href="#æ‰‹åŠ¨å†…å­˜æ•´ç†-memory-purge">æ‰‹åŠ¨å†…å­˜æ•´ç† Memory Purge</a></li>
    <li><a href="#ç»“è®º">ç»“è®º</a></li>
    <li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="https://github.com/Nanciico" title="Author" target="_blank" rel="noopener noreferrer author" class="author">Nanciico</a>
                </span>&nbsp;<span class="post-category">æ”¶å½•äº </span>&nbsp;<span class="post-category">ç±»åˆ« <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8A%80%E6%9C%AF/"><i class="far fa-folder fa-fw"></i>ä¸­é—´ä»¶æŠ€æœ¯</a></span>&nbsp;<span class="post-category">å’Œ</span>&nbsp;<span class="post-series">ç³»åˆ— <a href="/series/redis-%E5%8D%87%E7%BA%A7/"><i class="far fa-list-alt fa-fw"></i>Redis å‡çº§</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-04-19">2023-04-19</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-04-19">2023-04-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 2468 å­—&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details series-nav open">
                                <div class="details-summary series-title">
                                    <span>ç³»åˆ— - Redis å‡çº§</span>
                                    <span><i class="details-icon fas fa-angle-right"></i></span>
                                </div>
                                <div class="details-content series-content">
                                    <nav>
                                        <ul>
                                                    <li><a href="/redis%E5%8D%87%E7%BA%A7_00_%E5%BC%80%E7%AF%87/">Redis å‡çº§ â€”â€” å‰è¨€</a></li>
                                                    <li><a href="/redis%E5%8D%87%E7%BA%A7_01_%E5%BC%82%E6%AD%A5%E5%88%A0%E9%99%A4/">Redis å¼‚æ­¥åˆ é™¤è§£å†³å¤§ Key è¿‡æœŸé˜»å¡é—®é¢˜å¯è¡Œæ€§åˆ†æ</a></li><li><span class="active">Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”</span></li></ul>
                                    </nav>
                                </div>
                            </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› ">å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› </a>
      <ul>
        <li><a href="#å†…å­˜åˆ†é…åŸå› ">å†…å­˜åˆ†é…åŸå› </a></li>
        <li><a href="#é¢‘ç¹ä¿®æ”¹-redis-ä¸­æ•°æ®">é¢‘ç¹ä¿®æ”¹ Redis ä¸­æ•°æ®</a></li>
      </ul>
    </li>
    <li><a href="#å†…å­˜ç¢ç‰‡ç‡">å†…å­˜ç¢ç‰‡ç‡</a></li>
    <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®">å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®</a></li>
    <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°">å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°</a>
      <ul>
        <li><a href="#æ§åˆ¶å ç”¨-cpu-æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°">æ§åˆ¶å ç”¨ CPU æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°</a></li>
        <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°">å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°</a></li>
        <li><a href="#å†…å­˜ç¢ç‰‡æ•´ç†å¤§-key-æ˜¯å¦é˜»å¡">å†…å­˜ç¢ç‰‡æ•´ç†å¤§ Key æ˜¯å¦é˜»å¡</a></li>
      </ul>
    </li>
    <li><a href="#æ‰‹åŠ¨å†…å­˜æ•´ç†-memory-purge">æ‰‹åŠ¨å†…å­˜æ•´ç† Memory Purge</a></li>
    <li><a href="#ç»“è®º">ç»“è®º</a></li>
    <li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><hr>
<h2 id="å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› " class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e4%ba%a7%e7%94%9f%e5%8e%9f%e5%9b%a0" class="header-mark"></a>1 å†…å­˜ç¢ç‰‡äº§ç”ŸåŸå› </h2><p>å†…å­˜ç¢ç‰‡äº§ç”Ÿæœ‰ä¸¤ç§åŸå› </p>
<h3 id="å†…å­˜åˆ†é…åŸå› " class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d%e5%8e%9f%e5%9b%a0" class="header-mark"></a>1.1 å†…å­˜åˆ†é…åŸå› </h3><blockquote>
<p>To store user keys, Redis allocates at most as much memory as the maxmemory setting enables (however there are small extra allocations possible).</p>
</blockquote>
<p>Redis åœ¨åˆ†é…å†…å­˜æ—¶æœ‰å¯èƒ½ä¼šåˆ†é…å°‘é‡é¢å¤–ç©ºé—´ã€‚</p>
<p>Redis å°è£…çš„ zmalloc æ–¹æ³•ä¼šè°ƒç”¨ ztrymalloc_usable æ–¹æ³•é¢å¤–åˆ†é… PREFIX_SIZE å¤§å°çš„ç©ºé—´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cm">/* Try allocating memory, and return NULL if failed.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * &#39;*usable&#39; is set to the usable size if non NULL. */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">ztrymalloc_usable</span><span class="p">(</span><span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="o">*</span><span class="n">usable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Possible overflow, return NULL, so that the caller can panic or handle a failed allocation. */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">SIZE_MAX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">MALLOC_MIN_SIZE</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="n">PREFIX_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptr</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#ifdef HAVE_MALLOC_SIZE
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="n">size</span> <span class="o">=</span> <span class="n">zmalloc_size</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">update_zmalloc_stat_alloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">usable</span><span class="p">)</span> <span class="o">*</span><span class="n">usable</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="o">*</span><span class="p">((</span><span class="n">size_t</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">)</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">update_zmalloc_stat_alloc</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="n">PREFIX_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">usable</span><span class="p">)</span> <span class="o">*</span><span class="n">usable</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="o">+</span><span class="n">PREFIX_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶æ¬¡åœ¨é»˜è®¤å†…å­˜åˆ†é…å™¨ Jemalloc ä¸‹ï¼Œä¼šæŒ‰ç…§å›ºå®šå¤§å°åˆ†é…å†…å­˜ï¼Œæ¯”å¦‚éœ€è¦ç”³è¯· 6 bytesï¼Œä½†å®é™…åˆ†é… 8 bytesã€‚</p>
<h3 id="é¢‘ç¹ä¿®æ”¹-redis-ä¸­æ•°æ®" class="headerLink">
    <a href="#%e9%a2%91%e7%b9%81%e4%bf%ae%e6%94%b9-redis-%e4%b8%ad%e6%95%b0%e6%8d%ae" class="header-mark"></a>1.2 é¢‘ç¹ä¿®æ”¹ Redis ä¸­æ•°æ®</h3><blockquote>
<p>Redis will not always free up (return) memory to the OS when keys are removed. This is not something special about Redis, but it is how most malloc() implementations work. For example if you fill an instance with 5GB worth of data, and then remove the equivalent of 2GB of data, the Resident Set Size (also known as the RSS, which is the number of memory pages consumed by the process) will probably still be around 5GB, even if Redis will claim that the user memory is around 3GB. This happens because the underlying allocator can&rsquo;t easily release the memory. For example often most of the removed keys were allocated in the same pages as the other keys that still exist.</p>
</blockquote>
<p>åœ¨åˆ é™¤æ•°æ®æ—¶ï¼ŒRedis ä¸ä¼šç›´æ¥å°†è¯¥éƒ¨åˆ†å†…å­˜å½’è¿˜æ“ä½œç³»ç»Ÿï¼ŒåŸå› æ˜¯æœ‰å¯èƒ½æœ‰å…¶ä»–æ•°æ®è½åœ¨ç›¸åŒé¡µä¸Šï¼Œè¿™éƒ¨åˆ†åˆ é™¤çš„å†…å­˜ä¹Ÿä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
<hr>
<h2 id="å†…å­˜ç¢ç‰‡ç‡" class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e7%8e%87" class="header-mark"></a>2 å†…å­˜ç¢ç‰‡ç‡</h2><p>mem_fragmentation_ratio = used_memory_rss / used_memory</p>
<p>å¯ä»¥ç†è§£ä¸º Redis å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„å†…å­˜ä¸ Redis å®é™…ä½¿ç”¨å†…å­˜çš„æ¯”ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹å†…å­˜ç¢ç‰‡ç‡ç»´æŒåœ¨ 1.03 æœ€å¥½ã€‚æ­£å¸¸æƒ…å†µä¸‹åœ¨ 1-1.5 ä¹‹é—´ã€‚</p>
<hr>
<h2 id="å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®" class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e6%95%b4%e7%90%86%e5%8a%9f%e8%83%bd%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae" class="header-mark"></a>3 å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é»˜è®¤é…ç½®</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">activedefrag = 0                        # å†…å­˜ç¢ç‰‡æ•´ç†æ€»å¼€å…³ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">active-defrag-cycle-min = 1             # å†…å­˜ç¢ç‰‡æ•´ç†çš„ CPU æ—¶é—´å æ€» CPU æ—¶é—´ä¸ä½äº 1%ã€‚
</span></span><span class="line"><span class="cl">active-defrag-cycle-max = 25            # å†…å­˜ç¢ç‰‡æ•´ç†çš„ CPU æ—¶é—´å æ€» CPU æ—¶é—´ä¸é«˜äº 25%ã€‚
</span></span><span class="line"><span class="cl">active-defrag-threshold-lower = 10      # å†…å­˜ç¢ç‰‡ç‡å°äº 10%ï¼Œä¸è¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚
</span></span><span class="line"><span class="cl">active-defrag-threshold-upper = 100     # åœ¨ 100% ç¢ç‰‡ç‡æ—¶è¾¾åˆ°æœ€å¤§çš„ç¢ç‰‡æ•´ç†åŠ›åº¦ã€‚
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">active-defrag-max-scan-fields = 1000    # key ä¸­åŒ…å«çš„ field å¤§äº 1000 ä¼šè¢«å•ç‹¬å¤„ç†ã€‚
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">active-defrag-ignore-bytes = 100mb      # ç¢ç‰‡æ€»ç©ºé—´å°‘äº 100mb ä¸è¿›è¡Œå†…å­˜æ•´ç†ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°" class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e6%95%b4%e7%90%86%e7%9a%84%e5%ae%9e%e7%8e%b0" class="header-mark"></a>4 å†…å­˜ç¢ç‰‡æ•´ç†çš„å®ç°</h2><p>å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½é€šè¿‡ activeDefragCycle å‡½æ•°å®ç°ï¼Œè¯¥å‡½æ•°é€šè¿‡ serverCron å‡½æ•°è°ƒç”¨ï¼Œåœ¨å¼€å¯è¯¥åŠŸèƒ½åä¼šè¢«å®šæ—¶è°ƒç”¨ã€‚ä¸€æ¬¡å®Œæ•´çš„å†…å­˜ç¢ç‰‡æ•´ç†è¿‡ç¨‹éœ€è¦å¤šæ¬¡è°ƒç”¨ activeDefragCycle å‡½æ•°ï¼Œå³ä¼šæ¨ªè·¨å¤šæ¬¡å®šæ—¶ä»»åŠ¡ã€‚</p>
<h3 id="æ§åˆ¶å ç”¨-cpu-æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°" class="headerLink">
    <a href="#%e6%8e%a7%e5%88%b6%e5%8d%a0%e7%94%a8-cpu-%e6%97%b6%e9%97%b4%e6%af%94%e7%8e%87%e9%99%90%e5%88%b6%e7%9a%84%e5%ae%9e%e7%8e%b0" class="header-mark"></a>4.1 æ§åˆ¶å ç”¨ CPU æ—¶é—´æ¯”ç‡é™åˆ¶çš„å®ç°</h3><p>é€šè¿‡ active-defrag-cycle-minã€active-defrag-cycle-maxã€active-defrag-threshold-lowerã€active-defrag-threshold-upper å››ä¸ªé…ç½®èƒ½å¤Ÿæ§åˆ¶å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½å ç”¨ CPU æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</p>
<p>è¯¥ç™¾åˆ†æ¯”æœ€ç»ˆä¼šè¢«è®¡ç®—ä¸ºæ¯æ¬¡æ‰§è¡Œ activeDefragCycle å‡½æ•°çš„æœ€å¤§æ—¶é—´é™åˆ¶ timeLimitï¼Œä»è€Œæ§åˆ¶æ¯æ¬¡æ‰§è¡Œå†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½çš„æ—¶é—´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#define INTERPOLATE(x, x1, x2, y1, y2) ( (y1) + ((x)-(x1)) * ((y2)-(y1)) / ((x2)-(x1)) )
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LIMIT(y, min, max) ((y)&lt;(min)? min: ((y)&gt;(max)? max: (y)))
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cm">/* decide if defrag is needed, and at what CPU effort to invest in it */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">computeDefragCycles</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">frag_bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å¾—å†…å­˜ç¢ç‰‡ç‡å’Œå†…å­˜ç¢ç‰‡çš„æ€»å­—èŠ‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">frag_pct</span> <span class="o">=</span> <span class="n">getAllocatorFragmentation</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frag_bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* If we&#39;re not already running, and below the threshold, exit. */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœå½“å‰æœªè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ï¼Œä¸”å†…å­˜ç¢ç‰‡ç‡å’Œå†…å­˜ç¢ç‰‡æ€»å­—èŠ‚æ•°ä¸æ»¡è¶³é˜ˆå€¼è¦æ±‚ï¼Œé€€å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="n">active_defrag_running</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">frag_pct</span> <span class="o">&lt;</span> <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_threshold_lower</span> <span class="o">||</span> <span class="n">frag_bytes</span> <span class="o">&lt;</span> <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_ignore_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* Calculate the adaptive aggressiveness of the defrag */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è‡ªé€‚åº”è®¡ç®—å†…å­˜ç¢ç‰‡æ¸…ç†çš„ cpu å ç”¨ç™¾åˆ†æ¯”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">cpu_pct</span> <span class="o">=</span> <span class="n">INTERPOLATE</span><span class="p">(</span><span class="n">frag_pct</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_threshold_lower</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_threshold_upper</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_cycle_min</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_cycle_max</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å°† cpu å ç”¨ç™¾åˆ†æ¯”é™åˆ¶åœ¨ [active_defrag_cycle_min, active_defrag_cycle_max]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">cpu_pct</span> <span class="o">=</span> <span class="n">LIMIT</span><span class="p">(</span><span class="n">cpu_pct</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_cycle_min</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_cycle_max</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="cm">/* We allow increasing the aggressiveness during a scan, but don&#39;t
</span></span></span><span class="line"><span class="cl"><span class="cm">      * reduce it. */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">cpu_pct</span> <span class="o">&gt;</span> <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_running</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è®°å½•æ¯”ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_running</span> <span class="o">=</span> <span class="n">cpu_pct</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">serverLog</span><span class="p">(</span><span class="n">LL_VERBOSE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;Starting active defrag, frag=%.0f%%, frag_bytes=%zu, cpu=%d%%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">frag_pct</span><span class="p">,</span> <span class="n">frag_bytes</span><span class="p">,</span> <span class="n">cpu_pct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¡ç®—å…¬å¼ï¼š cycle-min + (frag_pct - threshold_lower) * (cycle_max - cycle_min) / (threshold_upper - threshold_lower)ã€‚</p>
<p>è‹¥å½“å‰å†…å­˜ç¢ç‰‡ç‡ä¸º 1.5ï¼Œåˆ™è®¡ç®—å‡ºæ¥çš„ cpu_pct = 14ã€‚</p>
<p>åˆ™ <code>timelimit = 1000000 * server.active_defrag_running / server.hz / 100 = 1000000 * 14 / 10 / 100 = 14,000 Î¼s = 14 ms</code>ã€‚</p>
<p>è¯¥å€¼è®¡ç®—å‡ºæ¥åï¼Œä¼šåœ¨æ¯ 16 æ¬¡ scanï¼Œæˆ–æ¯ 512 æ¬¡æŒ‡é’ˆç§»åŠ¨ï¼Œæˆ–æ¯ 64 ä¸ª key å®Œæˆå†…å­˜æ•´ç†å®Œæ¯•åï¼Œåˆ¤æ–­è¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡è¿è¡Œæ—¶é—´é™åˆ¶ï¼Œè‹¥è¶…è¿‡åˆ™é€€å‡ºæœ¬æ¬¡å†…å­˜æ•´ç†ã€‚</p>
<p>å³åœ¨å†…å­˜ç¢ç‰‡ç‡ä¸º 1.5 æ—¶ï¼Œæ¯æ¬¡å®šæ—¶ä»»åŠ¡ä¼šèŠ±è´¹ 14ms å·¦å³æ—¶é—´æ•´ç†å†…å­˜ç¢ç‰‡ã€‚</p>
<h3 id="å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°" class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e6%95%b4%e7%90%86%e6%a0%b8%e5%bf%83%e5%ae%9e%e7%8e%b0" class="header-mark"></a>4.2 å†…å­˜ç¢ç‰‡æ•´ç†æ ¸å¿ƒå®ç°</h3><p>å†…å­˜æ•´ç†åŠŸèƒ½é€šè¿‡ scan é”®ç©ºé—´å®ç°ã€‚æ¯æ¬¡ scan æ—¶ä¼šè°ƒç”¨ defragScanCallback å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œ scan å‡ºæ¥çš„ key çš„å†…å­˜ç¢ç‰‡æ¸…ç†å·¥ä½œã€‚</p>
<p><code>cursor = dictScan(db-&gt;dict, cursor, defragScanCallback, defragDictBucketCallback, db);</code></p>
<p>defragScanCallback è°ƒç”¨ defragKey å‡½æ•°ï¼Œå…ˆå°è¯•æ•´ç† key å¯¹è±¡ï¼Œå†åˆ¤æ–­ value å¯¹è±¡çš„ç¼–ç ä»è€Œè°ƒç”¨ç›¸å…³å‡½æ•°æ•´ç† value å¯¹è±¡ã€‚</p>
<p>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ activeDefragAlloc å‡½æ•°è¿›è¡Œå†…å­˜æ•´ç†ã€‚å†…å­˜æ•´ç†çš„è¿‡ç¨‹ä¸ºï¼šåˆ†é…æ–°å†…å­˜ã€å†…å­˜å¤åˆ¶ã€é‡Šæ”¾æ—§å†…å­˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cm">/* Defrag helper for generic allocations.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * returns NULL in case the allocation wasn&#39;t moved.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * when it returns a non-null value, the old pointer was already released
</span></span></span><span class="line"><span class="cl"><span class="cm"> * and should NOT be accessed. */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span><span class="o">*</span> <span class="nf">activeDefragAlloc</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">newptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">je_get_defrag_hint</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_misses</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* move this allocation to a new allocation.
</span></span></span><span class="line"><span class="cl"><span class="cm">     * make sure not to use the thread cache. so that we don&#39;t get back the same
</span></span></span><span class="line"><span class="cl"><span class="cm">     * pointers we try to free */</span>
</span></span><span class="line"><span class="cl">    <span class="n">size</span> <span class="o">=</span> <span class="n">zmalloc_size</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ†é…æ–°å†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">newptr</span> <span class="o">=</span> <span class="n">zmalloc_no_tcache</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å†…å­˜å¤åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">memcpy</span><span class="p">(</span><span class="n">newptr</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é‡Šæ”¾æ—§å†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">zfree_no_tcache</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">newptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±å®Œæˆäº†å•ä¸ªå†…å­˜åŒºåŸŸçš„å†…å­˜æ•´ç†ã€‚</p>
<h3 id="å†…å­˜ç¢ç‰‡æ•´ç†å¤§-key-æ˜¯å¦é˜»å¡" class="headerLink">
    <a href="#%e5%86%85%e5%ad%98%e7%a2%8e%e7%89%87%e6%95%b4%e7%90%86%e5%a4%a7-key-%e6%98%af%e5%90%a6%e9%98%bb%e5%a1%9e" class="header-mark"></a>4.3 å†…å­˜ç¢ç‰‡æ•´ç†å¤§ Key æ˜¯å¦é˜»å¡</h3><p>å‡è®¾æœ‰ä¸€å¤§ key å…¶æ‹¥æœ‰çš„å…ƒç´ ä¸º fields ä¸ªã€‚</p>
<p>åœ¨å¤„ç†åˆ°è¯¥ key æ—¶ï¼Œä¼šæ¯”è¾ƒ fields ä¸ active-defrag-max-scan-fields çš„å¤§å°ï¼Œè‹¥ fields &gt; active-defrag-max-scan-fieldsï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºå¤§ key æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨é‡Œï¼Œå¹¶è·³è¿‡è¯¥ key çš„å†…å­˜æ•´ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">dictSize</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">server</span><span class="p">.</span><span class="n">active_defrag_max_scan_fields</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">defragLater</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">kde</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="n">defragged</span> <span class="o">+=</span> <span class="n">activeDefragSdsDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">DEFRAG_SDS_DICT_VAL_IS_SDS</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ scan ä¸‹ä¸€ä¸ªæ¡¶ä¹‹å‰ï¼Œä¼šæ£€æŸ¥åˆ—è¡¨é‡Œæ˜¯å¦æœ‰å¤§ key æœªå®Œæˆå†…å­˜æ•´ç†ï¼Œè‹¥æœ‰åˆ™ä¼šå•ç‹¬ä¸ºå¤§ key è¿›è¡Œå†…å­˜æ•´ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cm">/* before scanning the next bucket, see if we have big keys left from the previous bucket to scan */</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">defragLaterStep</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">endtime</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">quit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* time is up, we didn&#39;t finish all the work */</span>
</span></span><span class="line"><span class="cl">    <span class="k">break</span><span class="p">;</span> <span class="cm">/* this will exit the function and we&#39;ll continue on the next cycle */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æ•´ç†å¤§ key çš„å†…å­˜æ—¶ï¼Œä¹Ÿä¼šåˆ†å¤šæ¬¡æ•´ç†ã€‚ä¼šåœ¨æ¯ 16 æ¬¡è¿­ä»£ï¼Œæˆ–æ¯ 512 ä¸ªæŒ‡é’ˆç§»åŠ¨ï¼Œæˆ–æ¯ 64 ä¸ª field å†…å­˜æ•´ç†å®Œæ¯•åï¼Œåˆ¤æ–­è¿è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡è¿è¡Œæ—¶é—´é™åˆ¶ï¼Œè‹¥è¶…è¿‡åˆ™é€€å‡ºæœ¬æ¬¡å†…å­˜æ•´ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">quit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">defragLaterItem</span><span class="p">(</span><span class="n">de</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">defrag_later_cursor</span><span class="p">,</span> <span class="n">endtime</span><span class="p">,</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">quit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* time is up, we didn&#39;t finish all the work */</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* Once in 16 scan iterations, 512 pointer reallocations, or 64 fields
</span></span></span><span class="line"><span class="cl"><span class="cm">        * (if we have a lot of pointers in one hash bucket, or rehashing),
</span></span></span><span class="line"><span class="cl"><span class="cm">        * check if we reached the time limit. */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">quit</span> <span class="o">||</span> <span class="p">(</span><span class="o">++</span><span class="n">iterations</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                    <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_hits</span> <span class="o">-</span> <span class="n">prev_defragged</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                    <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_scanned</span> <span class="o">-</span> <span class="n">prev_scanned</span> <span class="o">&gt;</span> <span class="mi">64</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">quit</span> <span class="o">||</span> <span class="n">ustime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">endtime</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">key_defragged</span> <span class="o">!=</span> <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_hits</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_key_hits</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_key_misses</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_defragged</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_hits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_scanned</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">stat_active_defrag_scanned</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">defrag_later_cursor</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å³ä¸€ä¸ªå¤§ key çš„å†…å­˜æ•´ç†ä¼šåˆ†å¤šæ¬¡å¤„ç†ï¼Œä¸ä¼šé•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
<hr>
<h2 id="æ‰‹åŠ¨å†…å­˜æ•´ç†-memory-purge" class="headerLink">
    <a href="#%e6%89%8b%e5%8a%a8%e5%86%85%e5%ad%98%e6%95%b4%e7%90%86-memory-purge" class="header-mark"></a>5 æ‰‹åŠ¨å†…å­˜æ•´ç† Memory Purge</h2><p>è¯¥å‘½ä»¤åªåœ¨ä½¿ç”¨ jemalloc å†…å­˜åˆ†é…å™¨ä¸‹ç”Ÿæ•ˆã€‚</p>
<p>è¯¥å‘½ä»¤æ¸…ç†å†…å­˜è„é¡µï¼Œå’Œä¸Šè¿°å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ç®¡ç†çš„ä¸æ˜¯ç›¸åŒåŒºåŸŸã€‚</p>
<hr>
<h2 id="ç»“è®º" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>6 ç»“è®º</h2><p>Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½æ˜¯é€šè¿‡ scan å‘½ä»¤æ¸è¿›å¼åœ°æ•´ç†æ¯æ¬¡è¿­ä»£åˆ°çš„ keyï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1), å®Œæ•´æ‰§è¡Œå®Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p>
<p>å†…å­˜ç¢ç‰‡æ•´ç†å¤§ key ä¼šå°†å¤§ key åˆ†å¤šæ¬¡å¤„ç†ï¼Œä¸ä¼šé•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
<p>å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½çš„æ ¸å¿ƒä½œç”¨æ˜¯é™ä½å†…å­˜ç¢ç‰‡ç‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ä»¥èŠ‚çœå†…å­˜æˆæœ¬ã€‚</p>
<p>ä½†å†…å­˜æ•´ç†åŠŸèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹è€Œé™ä½ Redis çš„æ€§èƒ½ã€‚</p>
<hr>
<h2 id="å‚è€ƒèµ„æ–™" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="header-mark"></a>7 å‚è€ƒèµ„æ–™</h2><p><a href="https://redis.io/docs/management/optimization/memory-optimization/" target="_blank" rel="noopener noreferrer">Memory optimization | Redis</a></p>
<p><a href="https://github.com/redis/redis/blob/unstable/src/defrag.c" target="_blank" rel="noopener noreferrer">redis/defrag.c at unstable Â· redis/redis Â· GitHub</a></p>
<p><a href="https://redis.io/commands/memory-purge/" target="_blank" rel="noopener noreferrer">MEMORY PURGE | Redis</a></p>
<hr>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2023-04-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”" data-hashtags="Redis"><span class="fab fa-twitter fa-fw"></span></button><button title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-hashtag="Redis"><span class="fab fa-facebook-square fa-fw"></span></button><button title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”" data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”"><span class="fab fa-weibo fa-fw"></span></button><button title="åˆ†äº«åˆ° Myspace" data-sharer="myspace" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”" data-description="åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚"><span data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></span></button><button title="åˆ†äº«åˆ° Blogger" data-sharer="blogger" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”" data-description="åˆ†æ Redis å†…å­˜ç¢ç‰‡æ•´ç†åŠŸèƒ½ï¼Œç»™å‡ºæ§åˆ¶å†…å­˜ç¢ç‰‡å¯è¡Œæ–¹æ¡ˆã€‚"><span class="fab fa-blogger fa-fw"></span></button><button title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://Nanciico.github.io/redis%E5%8D%87%E7%BA%A7_02_%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87/" data-title="Redis å†…å­˜ç¢ç‰‡æ•´ç†è°ƒç ”"><span class="fab fa-evernote fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/redis/">Redis</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E7%AE%97%E6%B3%95%E7%AC%AC%E5%9B%9B%E7%89%88_05_union-find%E7%AE%97%E6%B3%95/" class="prev" rel="prev" title="ç®—æ³•ç¬¬å››ç‰ˆ â€”â€” Union-Find ç®—æ³•"><i class="fas fa-angle-left fa-fw"></i>ç®—æ³•ç¬¬å››ç‰ˆ â€”â€” Union-Find ç®—æ³•</a>
            <a href="/%E7%AE%97%E6%B3%95%E7%AC%AC%E5%9B%9B%E7%89%88_06_%E5%88%9D%E7%BA%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="next" rel="next" title="ç®—æ³•ç¬¬å››ç‰ˆ â€”â€” åˆçº§æ’åºç®—æ³•">ç®—æ³•ç¬¬å››ç‰ˆ â€”â€” åˆçº§æ’åºç®—æ³•<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/Nanciico" target="_blank" rel="noopener noreferrer">Nanciico</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":20},"comment":{},"data":{"desktop-header-typeit":"Nanciico's Blog~","mobile-header-typeit":"Nanciico's Blog~"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js" defer></script><script type="text/javascript" src="/js/twemoji.min.js" defer></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>